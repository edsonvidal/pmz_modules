<?xml version="1.0"?>
<root>
  <OBJECT NAME="CLIENTES">
    <METHOD NAME="Listar" DESCRIPTION="Listar clientes com base em filtros informados" VERSION="392" INTFTYPE="5" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
          <GROUP NAME="Filtros" STYLE="1"/>
        </GROUPS>
        <PARAM NAME="COD_CLIENTE" SIZE="12" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="C&#243;digo" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="NOME" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Raz&#227;o Social" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="FANTASIA" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Fantasia" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="IE" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Ie" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="RG" SIZE="12" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Rg" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="CPF" SIZE="14" FLAGS="1" MASK="###.###.###-##" PROJECTION="0" ORDER="10" FIELDLABEL="Cpf" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="CNPJ" SIZE="19" FLAGS="1" MASK="##.###.###/####-##" PROJECTION="0" ORDER="7" FIELDLABEL="Cnpj" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="DATA_ATUALIZACAO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Data Atualizacao" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="TRANS_ID" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Trans Id" GROUPNAME="Filtros" CTAB="0"/>
        <PARAM NAME="TOP" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Top" CTAB="0"/>
        <PARAM NAME="CLIENTE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Cliente" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="CLIENTE" FORMAT="N" SIZE="8" FLAGS="9" PROJECTION="0" HINT="Coodigo Interno do Cliente nao visivel ao usuario final" ORDER="20" FIELDLABEL="Cliente" CTAB="0"/>
        <FIELD NAME="CODIGO" SIZE="25" FLAGS="17" PROJECTION="0" HINT="Codigo do Cliente" ORDER="21" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <FIELD NAME="NOME" SIZE="60" FLAGS="17" PROJECTION="0" HINT="Nome / Razao Social do Cliente" ORDER="22" FIELDLABEL="Raz&#227;o Social" CTAB="0"/>
        <FIELD NAME="FANTASIA" SIZE="30" FLAGS="1" PROJECTION="0" HINT="nome fantasia do cliente" ORDER="23" FIELDLABEL="Fantasia" CTAB="0"/>
        <FIELD NAME="CNPJ" SIZE="18" FLAGS="1" PROJECTION="0" HINT="CNPJ do Cliente" ORDER="24" FIELDLABEL="Cnpj" CTAB="0"/>
        <FIELD NAME="IE" SIZE="20" FLAGS="1" PROJECTION="0" HINT="Iscricao Estadual do cliente" ORDER="25" FIELDLABEL="Ie" CTAB="0"/>
        <FIELD NAME="CPF" SIZE="14" FLAGS="1" PROJECTION="0" HINT="CPF do cliente" ORDER="26" FIELDLABEL="Cpf" CTAB="0"/>
        <FIELD NAME="RG" SIZE="12" FLAGS="1" PROJECTION="0" HINT="RG do cliente" ORDER="27" FIELDLABEL="Rg" CTAB="0"/>
        <FIELD NAME="DDD" SIZE="4" FLAGS="1" PROJECTION="0" HINT="ddd do telefone do endereco de nota fiscal" ORDER="28" FIELDLABEL="Ddd" CTAB="0"/>
        <FIELD NAME="FONE" SIZE="20" FLAGS="1" PROJECTION="0" HINT="telefone do endereco de nota fiscal" ORDER="29" FIELDLABEL="Fone" CTAB="0"/>
        <FIELD NAME="LOGRADOURO" SIZE="60" FLAGS="1" PROJECTION="0" HINT="endereco de nota fiscal" ORDER="32" FIELDLABEL="Endere&#231;o" CTAB="0"/>
        <FIELD NAME="BAIRRO" SIZE="20" FLAGS="1" PROJECTION="0" HINT="Bairro do endereco da nota fiscal" ORDER="33" FIELDLABEL="Bairro" CTAB="0"/>
        <FIELD NAME="CIDADE" SIZE="40" FLAGS="1" PROJECTION="0" HINT="cidade do endereco de nota fiscal" ORDER="34" FIELDLABEL="Cidade" CTAB="0"/>
        <FIELD NAME="ESTADO" SIZE="2" FLAGS="1" PROJECTION="0" HINT="Estado do endereco da nota fiscal" ORDER="35" FIELDLABEL="Estado" CTAB="0"/>
        <FIELD NAME="CEP" SIZE="9" FLAGS="1" PROJECTION="0" HINT="CEP do cliente" ORDER="36" FIELDLABEL="Cep" CTAB="0"/>
        <FIELD NAME="DATA_ATUALIZACAO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" HINT="data da ultima atualizacao do cadastro de cliente" ORDER="40" FIELDLABEL="Data Atualizacao" CTAB="0"/>
        <FIELD NAME="DATA_CADASTRO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" HINT="data em que o cliente foi cadastradp" ORDER="42" FIELDLABEL="Data Cadastro" CTAB="0"/>
        <FIELD NAME="E_MAIL" SIZE="40" FLAGS="1" PROJECTION="0" HINT="email padrao para emissao do boleto bancario" ORDER="30" FIELDLABEL="E Mail" CTAB="0"/>
        <FIELD NAME="E_MAIL_NFE" SIZE="100" FLAGS="1" PROJECTION="0" HINT="e-mail padrao para emissao da nf-e" ORDER="31" FIELDLABEL="E Mail Nfe" CTAB="0"/>
        <FIELD NAME="NAOCONTRIBUINTE_ICMS" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" HINT="campo que identifica se o cliente eh contribuinte icms" ORDER="41" FIELDLABEL="N&#227;o Contribuinte ICMS" CTAB="0"/>
        <FIELD NAME="TABELA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="id da tabela de preco vinculada ao cliente, quando o cliente possui uma tabela de preco exclusiva" ORDER="37" FIELDLABEL="Tabela" CTAB="0"/>
        <FIELD NAME="BLOQUEIA_VENDAS" SIZE="1" FLAGS="1" PROJECTION="0" HINT="campo que identifica se o cliente esta bloqueado para vendas (faturamento)" ORDER="39" FIELDLABEL="Bloqueia Vendas" CTAB="0"/>
        <FIELD NAME="BLOQUEIA_PEDIDOS" SIZE="1" FLAGS="1" PROJECTION="0" HINT="campo que determina se o cliente esta bloqueado para emissao de pedido de venda" ORDER="38" FIELDLABEL="Bloqueia Pedidos" CTAB="0"/>
        <FIELD NAME="REPRESENTANTE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Id do representante" ORDER="18" FIELDLABEL="Representante" CTAB="0"/>
        <FIELD NAME="DESC_TIPO_EMPRESA" SIZE="30" FLAGS="1" PROJECTION="0" HINT="Descricao do tipo de empresa" ORDER="16" FIELDLABEL="Desc Tipo Empresa" CTAB="0"/>
        <FIELD NAME="TIPO_EMPRESA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Id do tipo de empresa" ORDER="19" FIELDLABEL="Tipo Empresa" CTAB="0"/>
        <FIELD NAME="FILIAL_ULTIMO_PEDIDO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Id da filial do &#250;ltimo pedido de venda" ORDER="17" FIELDLABEL="Filial Ultimo Pedido" CTAB="0"/>
        <FIELD NAME="TRANS_ID" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="15" FIELDLABEL="Trans Id" CTAB="0"/>
        <FIELD NAME="GERADOR" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="14" FIELDLABEL="Gerador" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT #SELECT(TOP,NULL:{},ELSE:{#TOP(:TOP)})
       C.CLIENTE AS CLIENTE,
       C.GERADOR AS GERADOR,
       C.TRANS_ID AS TRANS_ID,
       C.COD_CLIENTE AS CODIGO,
       C.NOME AS NOME,
       MIN(TP.DESCRICAO) AS DESC_TIPO_EMPRESA,
       MIN(C.TIPO_EMPRESA) AS TIPO_EMPRESA,
       MIN(C.CGC) AS CNPJ,
       MIN(C.CPF) AS CPF,
       MIN(E.CEP) AS CEP,
       MIN(E.LOGRADOURO) AS LOGRADOURO,
       MIN(E.CIDADE) AS CIDADE,
       MIN(E.FONE) AS FONE,
       MIN(C.CONTATO) AS CONTATO,
       MIN(E.BAIRRO) AS BAIRRO,
       MIN(E.ESTADO) AS ESTADO,
       MIN(C.IE) AS IE,
       MIN(C.NAOCONTRIBUINTE_ICMS) AS NAOCONTRIBUINTE_ICMS,
       MIN(C.RG) AS RG,
       MIN(C.DATA_CADASTRO) AS DATA_CADASTRO,
       MIN(C.DATA_ATUALIZACAO) AS DATA_ATUALIZACAO,
       C.FANTASIA AS FANTASIA,
       MIN(C.E_MAIL) AS E_MAIL,
       MIN(E.DDD) AS DDD,
       MIN(C.CEL) AS CEL,
       min(c.tabela) as tabela,
       min(c.e_mail_nfe) AS E_MAIL_NFE,
       min(c.bloqueia_pedidos) AS bloqueia_pedidos,
       min(c.bloqueia_vendas) AS bloqueia_vendas,
       min(c.REPRESENTANTE) AS REPRESENTANTE,
       (SELECT FIRST 1 FILIAL FROM PEDIDO_VENDA PV WHERE CLIENTE = 37 ORDER BY PEDIDOV DESC) AS FILIAL_ULTIMO_PEDIDO
FROM CLIENTES C
  LEFT JOIN ENDERECOS_CADASTRO E ON E.GERADOR=C.GERADOR  AND  ENDERECO_NOTA='T'
  INNER JOIN TIPOS_EMPRESA TP ON TP.TIPO_EMPRESA = C.TIPO_EMPRESA
WHERE
[C.COD_CLIENTE=:COD_CLIENTE]
[AND C.NOME LIKE #REPLACETR(:NOME)]  
[AND C.FANTASIA LIKE #REPLACETR(:FANTASIA)]  
[AND C.IE=:IE]
[AND C.RG=:RG]  
[AND C.CGC=:CNPJ]
[AND C.CPF=:CPF] 
[AND C.DATA_ATUALIZACAO>=:DATA_ATUALIZACAO]
[AND C.TRANS_ID>:TRANS_ID]
[AND C.CLIENTE=:CLIENTE]
GROUP BY C.CLIENTE,C.GERADOR,C.TRANS_ID,C.COD_CLIENTE,C.NOME,C.FANTASIA
ORDER BY TRANS_ID
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>