<?xml version="1.0"?>
<root>
  <OBJECT NAME="WMS">
    <METHOD NAME="ListaSaldoLocal" DESCRIPTION="Lista Saldo Estoque pos Local" VERSION="44" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="PRODUTO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Produto" CTAB="0"/>
        <PARAM NAME="LOCAIS_ESTOQUE" SIZE="255" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="4" LOOKUP="MILLENIUM.LOCAIS_ESTOQUE.LISTA" LOOKUPKEY="IDLOCAL" LOOKUPDISPLAY="LOCAL" FIELDLABEL="Locais Estoque" CTAB="0"/>
        <PARAM NAME="TIPO_LOCAL" SIZE="5" FLAGS="17" DEFAULT="2" PROJECTION="0" ORDER="2" LOOKUP="list:'0','Exceto S/Local';'1','Somente S/Local';'2','Posi&#231;&#245;es+s/local';" FIELDLABEL="Tipo Local" CTAB="0"/>
        <PARAM NAME="FILIAL" SIZE="255" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="1" LOOKUP="MILLENIUM.FILIAIS.LISTA_FILIAIS" LOOKUPKEY="FILIAL" LOOKUPDISPLAY="NOME_FANTASIA" LOOKUPCODE="COD_FILIAL" FIELDLABEL="Filial" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="COD_PRODUTO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <FIELD NAME="DESC_PRODUTO" SIZE="50" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Descri&#231;&#227;o" CTAB="0"/>
        <FIELD NAME="COD_ESTAMPA" SIZE="5" PROJECTION="0" ORDER="3" FIELDLABEL="Estamp" CTAB="0"/>
        <FIELD NAME="DESC_ESTAMPA" SIZE="10" PROJECTION="0" ORDER="4" FIELDLABEL="Desc.Est" CTAB="0"/>
        <FIELD NAME="COD_COR" SIZE="5" PROJECTION="0" ORDER="8" FIELDLABEL="Cor" CTAB="0"/>
        <FIELD NAME="DESC_COR" SIZE="10" PROJECTION="0" ORDER="9" FIELDLABEL="Desc.Cor" CTAB="0"/>
        <FIELD NAME="TAMANHO" SIZE="5" PROJECTION="0" ORDER="10" FIELDLABEL="Tam" CTAB="0"/>
        <FIELD NAME="LOCAL" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Local" CTAB="0"/>
        <FIELD NAME="DISPONIVEL" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Dispon&#237;vel" CTAB="0"/>
        <FIELD NAME="RESERVA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Reserva" CTAB="0"/>
        <FIELD NAME="FISICO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="F&#237;sico" CTAB="0"/>
        <FIELD NAME="RESERVA_WMS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="Reserva Wms" CTAB="0"/>
        <FIELD NAME="RECEB_WMS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="14" FIELDLABEL="Receb Wms" CTAB="0"/>
        <FIELD NAME="TRANSITO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="15" FIELDLABEL="Transito" CTAB="0"/>
        <FIELD NAME="LOJA" SIZE="5" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Loja" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>select
        F.COD_FILIAL                AS LOJA,
		EL.PRODUTO,
		EL.ESTAMPA,
		EL.COR,
		EL.TAMANHO,
		el.IDLOCAL,
		MAX(p.cod_produto)			AS COD_PRODUTO,
		MAX(p.descricao1)			AS DESC_PRODUTO,
		MAX(c.COD_COR)				AS COD_COR,
		MAX(c.DESCRICAO)			as DESC_COR,
		MAX(EL.TAMANHO)				AS TAMANHO,
		max(le.local)				AS LOCAL,
		SUM(EL.SALDO)				AS DISPONIVEL,
		SUM(EL.EMPENHO)				AS RESERVA,
		SUM(EL.EMPENHO+EL.SALDO)	AS FISICO,
		SUM(EL.EMPENHO_LOCAL)		AS RESERVA_WMS,
		SUM(EL.RECEBIMENTO_LOCAL)	AS RECEB_WMS,
		SUM(EL.RECEBIMENTO)	        AS TRANSITO


from ESTOQUES_LOCAIS el

inner join produtos p on p.PRODUTO=el.PRODUTO
inner join filiais f  on  f.filial=el.filial
inner join estampas e on e.ESTAMPA=el.ESTAMPA
inner join cores c on c.cor = el.COR
left join locais_estoque le on le.IDLOCAL=el.IDLOCAL

WHERE

#select(TIPO_LOCAL, 0:{el.idlocal is not null},
                  1:{ el.idlocal is null},
              else:{ ((el.idlocal is not null) or (el.idlocal is null)) })
      [AND P.COD_PRODUTO=:PRODUTO]
      [AND F.FILIAL IN #REPLACE (:FILIAL)]
      [AND EL.IDLOCAL IN #REPLACE (:LOCAIS_ESTOQUE)]





GROUP BY
		F.COD_FILIAL,
        EL.PRODUTO,
		EL.ESTAMPA,
		EL.COR,
		EL.TAMANHO,
		EL.IDLOCAL

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>