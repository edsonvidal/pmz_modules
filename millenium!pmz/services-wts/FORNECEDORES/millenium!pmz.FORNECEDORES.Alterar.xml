<?xml version="1.0"?>
<root>
  <OBJECT NAME="FORNECEDORES">
    <METHOD NAME="Alterar" DESCRIPTION="Alterar Fornecedor" VERSION="378" INTFTYPE="2" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
          <GROUP NAME="Dados do Fornecedor" STYLE="1"/>
          <GROUP NAME="Classifica&#231;&#227;o"/>
          <GROUP NAME="Conceito"/>
          <GROUP NAME="Acesso a Oficinas"/>
          <GROUP NAME="Cota&#231;&#227;o / Envio para o Fornecedor"/>
          <GROUP NAME="Integra&#231;&#227;o"/>
          <GROUP NAME="Avalia&#231;&#227;o"/>
          <GROUP NAME="Acerto de Fornecedor"/>
          <GROUP NAME="Contabiliza&#231;&#227;o" STYLE="1"/>
          <GROUP NAME="Royalties"/>
        </GROUPS>
        <PARAM NAME="FORNECEDOR" FORMAT="+" SIZE="8" FLAGS="1025" PROJECTION="0" ORDER="1" FIELDLABEL="Fornecedor" CTAB="0"/>
        <PARAM NAME="COD_FORNECEDOR" SIZE="10" FLAGS="17" DEFAULT="millenium.utils.default(['COD_FORNECEDOR',5],'Result',True)" SOURCEEXPRESSION="fornecedor.gerador.COD_FORNECEDOR" PROJECTION="0" ORDER="3" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <PARAM NAME="GERADORES" FORMAT="R" FLAGS="1" VISIBILITYRULE="(GERADOR_ORIGEM='')" STYLE="8" PROJECTION="0" ORDER="4" FIELDLABEL="Geradores" NESTEDNAME="MILLENIUM.GERADORES.GERADORES" CTAB="0"/>
        <PARAM NAME="PCONTA" FORMAT="N" SIZE="8" FLAGS="1" STYLE="5" PROJECTION="0" ORDER="15" LOOKUP="PLANO_CONTAS.ListaTodos" LOOKUPKEY="PCONTA" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CLASSIFICACAO" FIELDLABEL="Plano de Contas" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="PRODUTOS_FORNEC" SIZE="50" FLAGS="1" SOURCEEXPRESSION="fornecedor.gerador.PRODUTOS_FORNEC" PROJECTION="0" ORDER="12" FIELDLABEL="Fornece" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="EAN" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Ean" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="OFICINA" FORMAT="B" SIZE="1" FLAGS="17" DEFAULT="FALSE" PROJECTION="0" ORDER="21" FIELDLABEL="Oficina" GROUPNAME="Acesso a Oficinas" CTAB="0"/>
        <PARAM NAME="TIPO" SIZE="1" DEFAULT="P" PROJECTION="0" FIELDLABEL="Tipo" CTAB="0"/>
        <PARAM NAME="STATUS" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="38" LOOKUP="list:'A','Ativo';'I','Inativo';" FIELDLABEL="Status" GROUPNAME="Avalia&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="HOMOLOGADO" FORMAT="B" SIZE="1" FLAGS="1" DEFAULT="1" PROJECTION="0" ORDER="40" FIELDLABEL="Homologado" GROUPNAME="Avalia&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="VALIDADE_HOMOLOGACAO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="41" FIELDLABEL="Validade Homologa&#231;&#227;o" GROUPNAME="Avalia&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="ULT_COMPRA" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="39" FIELDLABEL="&#218;ltima Compra" GROUPNAME="Avalia&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="INTERMEDIARIO" FORMAT="B" SIZE="1" FLAGS="1" DEFAULT="FALSE" PROJECTION="0" ORDER="14" FIELDLABEL="Intermedi&#225;rio" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="BANCO" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="8" LOOKUP="BANCOS.Lista" LOOKUPKEY="BANCO" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Banco" GROUPNAME="Dados do Fornecedor" CTAB="0"/>
        <PARAM NAME="FILIAL" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="6" LOOKUP="FILIAIS.LISTA_SIMPLES" LOOKUPKEY="FILIAL" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_FILIAL" FIELDLABEL="Filial" GROUPNAME="Dados do Fornecedor" CTAB="0"/>
        <PARAM NAME="ENVIO_TITULO" FORMAT="B" SIZE="1" FLAGS="17" VISIBILITYRULE="(OFICINA=TRUE)" DEFAULT="F" PROJECTION="0" ORDER="22" FIELDLABEL="Gerar T&#237;tulos no Envio para Oficina" GROUPNAME="Acesso a Oficinas" CTAB="0"/>
        <PARAM NAME="CLSFORNEC" FORMAT="N" SIZE="8" FLAGS="1" SOURCEEXPRESSION="fornecedor.gerador.clsfornec" PROJECTION="0" ORDER="9" LOOKUP="CLASSIFICACAO_FORNECEDOR.LISTA" LOOKUPKEY="CLSFORNEC" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="COD_CLSFORNEC" FIELDLABEL="Classifica&#231;&#227;o" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="GERADOR_ORIGEM" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Gerador Origem" CTAB="0"/>
        <PARAM NAME="CC_DEBITO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="46" LOOKUP="CONTA_CONTABIL.ListaParaLancamento" LOOKUPKEY="CONTA_CONTABIL" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Conta Cont&#225;bil Cr&#233;dito" GROUPNAME="Contabiliza&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="CC_CREDITO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="47" LOOKUP="CONTA_CONTABIL.ListaParaLancamento" LOOKUPKEY="CONTA_CONTABIL" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Conta Cont&#225;bil T&#237;tulo" GROUPNAME="Contabiliza&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="DESCONTO" FORMAT="N" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="19" FIELDLABEL="Desconto (%)" GROUPNAME="Conceito" CTAB="0"/>
        <PARAM NAME="GRUPO_LOJA" FORMAT="N" SIZE="8" FLAGS="1" STYLE="5" SOURCEEXPRESSION="fornecedor.gerador.grupo_loja" PROJECTION="0" ORDER="13" LOOKUP="GRUPO_LOJAS.lista_fornecedores" LOOKUPKEY="GRUPO_LOJA" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_GRUPO" FIELDLABEL="Grupo Loja/Fam&#237;lia" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="GERA_TITULO_PREVISAO" FORMAT="B" SIZE="1" FLAGS="17" VISIBILITYRULE="(OFICINA=TRUE) AND (ENVIO_TITULO=TRUE)" DEFAULT="F" PROJECTION="0" ORDER="23" FIELDLABEL="Gerar T&#237;tulo de Envio como Previs&#227;o" GROUPNAME="Acesso a Oficinas" CTAB="0"/>
        <PARAM NAME="DISPONIVEL_WEB" FORMAT="B" SIZE="1" FLAGS="1" DEFAULT="F" PROJECTION="0" ORDER="10" FIELDLABEL="Dispon&#237;vel na Web" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="PASTACOTACAO" SIZE="50" FLAGS="1" PROJECTION="0" ORDER="25" FIELDLABEL="Pasta de retorno de Cota&#231;&#227;o e envio de Pedidos" GROUPNAME="Cota&#231;&#227;o / Envio para o Fornecedor" CTAB="0"/>
        <PARAM NAME="CC_ADIANTAMENTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="45" LOOKUP="CONTA_CONTABIL.ListaParaLancamento" LOOKUPKEY="CONTA_CONTABIL" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Conta Cont&#225;bil Adiantamento" GROUPNAME="Contabiliza&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="LICENCIADO" FORMAT="B" SIZE="1" FLAGS="16" DEFAULT="F" PROJECTION="0" ORDER="36" FIELDLABEL="Licenciado" GROUPNAME="Royalties" CTAB="0"/>
        <PARAM NAME="ROYALTIE" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="37" LOOKUP="ROYALTIES.Lista" LOOKUPKEY="ROYALTIE" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="COD_ROYALTIE" FIELDLABEL="Regra Royaltie" GROUPNAME="Royalties" CTAB="0"/>
        <PARAM NAME="E_MAIL_NFE" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="E-mail NFe" GROUPNAME="Dados do Fornecedor" CTAB="0"/>
        <PARAM NAME="INTEGRACAO_JUST_IN_TIME" SIZE="1" FLAGS="17" DEFAULT="F" PROJECTION="0" HINT="&lt;b>Completa:&lt;/b>Requisi&#231;&#227;o de compra gera o pedido de compra na filial/loja e o pedido de compra gera o pedido de venda na matriz&lt;br>&lt;b>Parcial:&lt;/b>Requisi&#231;&#227;o de compra gera o pedido de compra na filial/loja." ORDER="27" LOOKUP="list:'F','N&#227;o Utiliza';'T','Completa';'P','Parcial';" FIELDLABEL="Integra&#231;&#227;o JUST-IN-TIME de pedidos" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="URL_REST" SIZE="70" FLAGS="1" VISIBILITYRULE="(INTEGRACAO_JUST_IN_TIME='T') OR (INTEGRACAO_JUST_IN_TIME_ESTOQUE=TRUE)" PROJECTION="0" HINT="Exemplos:&lt;br>Modelo Integra&#231;&#227;o JUST-IN-TIME de pedidos = 127.0.0.1:6017 &lt;br>Modelo Integra&#231;&#227;o JUST-IN-TIME de estoque = 127.0.0.1:6017/MILLENIUM!CLIENTE.OBJETO.SALDODEESTOQUE" ORDER="29" FIELDLABEL="Url integra&#231;&#227;o REST" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="TIPO_PEDIDO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="32" LOOKUP="TIPOS_PEDIDO.Lista_Compras" LOOKUPKEY="TIPO_PEDIDO" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Tipo de Pedido" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="CONDICOES_PGTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="33" LOOKUP="CONDICOES_PGTO.LISTA" LOOKUPKEY="CONDICOES_PGTO" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Condi&#231;&#227;o Pgto" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="CENTRO_CUSTOS" FORMAT="N" SIZE="8" FLAGS="1" STYLE="1" PROJECTION="0" ORDER="16" LOOKUP="CENTRO_CUSTOS.Lista" LOOKUPKEY="CENTRO_CUSTOS" LOOKUPDISPLAY="NOME" LOOKUPCODE="CODIGO" FIELDLABEL="Centro Custos" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="USUARIO_JUST_IN_TIME" SIZE="30" FLAGS="1" VISIBILITYRULE="(INTEGRACAO_JUST_IN_TIME='T') OR (INTEGRACAO_JUST_IN_TIME_ESTOQUE=TRUE)" PROJECTION="0" ORDER="30" FIELDLABEL="Usu&#225;rio Just In Time" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="SENHA_JUST_IN_TIME" SIZE="30" FLAGS="2049" VISIBILITYRULE="(INTEGRACAO_JUST_IN_TIME='T') OR (INTEGRACAO_JUST_IN_TIME_ESTOQUE=TRUE)" PROJECTION="0" ORDER="31" FIELDLABEL="Senha Just In Time" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="DIA_BASE_ACERTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Dia base para formar a data base para calcular vencimento dos t&#237;tulos no acerto de fornecedor." ORDER="43" FIELDLABEL="Dia Base para Acerto" GROUPNAME="Acerto de Fornecedor" CTAB="0"/>
        <PARAM NAME="CONTROLA_LICENCIADOS" FORMAT="B" SIZE="1" FLAGS="17" DEFAULT="F" PROJECTION="0" HINT="Ao ligar esse par&#226;metro o sistema passa a fazer o processo de controle de produtos licenciados" ORDER="2" FIELDLABEL="Controla Licenciados" CTAB="0"/>
        <PARAM NAME="FREQUENCIA_VISITAS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="17" FIELDLABEL="Frequ&#234;ncia de visitas" GROUPNAME="Classifica&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="ENVIA_CLIENTE" FORMAT="B" SIZE="1" FLAGS="17" VISIBILITYRULE="(INTEGRACAO_JUST_IN_TIME='T')" DEFAULT="F" PROJECTION="0" HINT="Envia o cadastro do cliente na integra&#231;&#227;o Just-in-time quando o pedido de compra na loja (filial) envia os dados para a matriz criar o pedido de venda" ORDER="34" FIELDLABEL="Envia Cliente" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="INTEGRACAO_JUST_IN_TIME_ESTOQUE" FORMAT="B" SIZE="1" FLAGS="17" DEFAULT="F" PROJECTION="0" HINT="Define que esse fornecedor ser&#225; usado para atualizar o estoque na integra&#231;&#227;o e-commerce Vtex" ORDER="28" FIELDLABEL="Integra&#231;&#227;o JUST-IN-TIME de estoque" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="MODALIDADE_FRETE" SIZE="1" FLAGS="1" VISIBILITYRULE="(INTEGRACAO_JUST_IN_TIME='T') AND (ENVIA_CLIENTE=TRUE)" PROJECTION="0" ORDER="35" LOOKUP="list:'0','0 - Contrata&#231;&#227;o por conta do Remetente (CIF);';'1','1 - Contrata&#231;&#227;o por conta do Destinat&#225;rio (FOB)';'2','2 - Contrata&#231;&#227;o por conta de Terceiros';'3','3 - Transporte Pr&#243;prio por conta do Remetente';'4','4 - Transporte Pr&#243;prio por conta do Destinat&#225;rio';'9','9 - Sem Ocorr&#234;ncia de Transporte';'5','0 - Emitente (soma Frete) (FOB)';" FIELDLABEL="Modalidade Frete" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="EVENTO_FAT_AUTO" FORMAT="N" SIZE="8" FLAGS="1" VISIBILITYRULE="(INTEGRACAO_JUST_IN_TIME='T')" PROJECTION="0" ORDER="36" LOOKUP="EVENTOS.ListaEventos_TipoPedidos" LOOKUPKEY="EVENTO" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Evento para Faturamento Autom&#225;tico de Pr&#233;-faturamentos" GROUPNAME="Integra&#231;&#227;o" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="FORNECEDOR" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Fornecedor" CTAB="0"/>
        <FIELD NAME="GERADOR" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Gerador" CTAB="0"/>
        <FIELD NAME="TRANS_ID" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Trans Id" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>#CHECK("SELECT COUNT(COD_FORNECEDOR) AS N FROM FORNECEDORES WHERE (COD_FORNECEDOR=:COD_FORNECEDOR [OR CGC=:GERADORES.CGC] [OR CNPJ=:GERADORES.CNPJ] [OR RG=:GERADORES.RG] [OR CPF=:GERADORES.CPF]) AND FORNECEDOR&lt;>:FORNECEDOR", N>0, const.FORNECEDOR_DUPLICADO);

SELECT COUNT(F.COD_FORNECEDOR) AS C
  FROM FORNECEDORES F
 INNER JOIN LANCAMENTOS L
       ON L.COD = F.FORNECEDOR AND L.GERADOR = 'O'
 INNER JOIN PRODUCAO P
       ON P.PRODUCAO = L.ORIGEM AND L.TIPO_ORIGEM = 'P'
 WHERE F.FORNECEDOR = :FORNECEDOR
   AND F.OFICINA=:OFICINA
   AND F.ENVIO_TITULO &lt;> :ENVIO_TITULO
   AND P.STATUS &lt;> 'F'
   AND P.STATUS &lt;> 'Q'
#CHECK("",C > 0,"Existem titulos de ordens de produ&#231;&#227;o em aberto gerados para este fornecedor.");

UPDATE IFORNECEDORES
SET COD_FORNECEDOR=:COD_FORNECEDOR,  PCONTA=:PCONTA,
PRODUTOS_FORNEC=:PRODUTOS_FORNEC, EAN=:EAN,
OFICINA=:OFICINA, STATUS=:STATUS , HOMOLOGADO =:HOMOLOGADO ,
VALIDADE_HOMOLOGACAO =:VALIDADE_HOMOLOGACAO ,
ULT_COMPRA =:ULT_COMPRA , INTERMEDIARIO=:INTERMEDIARIO , BANCO = :BANCO, FILIAL = :FILIAL, ENVIO_TITULO=:ENVIO_TITULO,
CLSFORNEC = :CLSFORNEC,
CC_CREDITO=:CC_CREDITO,
CC_DEBITO=:CC_DEBITO,
DESCONTO=:DESCONTO,
GRUPO_LOJA=:GRUPO_LOJA,
GERA_TITULO_PREVISAO=:GERA_TITULO_PREVISAO,
DISPONIVEL_WEB=:DISPONIVEL_WEB,
DATA_ATUALIZACAO=#NOW(),
PASTACOTACAO=:PASTACOTACAO
, CC_ADIANTAMENTO=:CC_ADIANTAMENTO
, LICENCIADO=:LICENCIADO
, ROYALTIE=:ROYALTIE
, E_MAIL_NFE=:E_MAIL_NFE
, INTEGRACAO_JUST_IN_TIME=:INTEGRACAO_JUST_IN_TIME
, INTEGRACAO_JUST_IN_TIME_ESTOQUE=:INTEGRACAO_JUST_IN_TIME_ESTOQUE
, URL_REST=:URL_REST
, TIPO_PEDIDO=:TIPO_PEDIDO
, CONDICOES_PGTO=:CONDICOES_PGTO
, CENTRO_CUSTOS=:CENTRO_CUSTOS
, USUARIO_JUST_IN_TIME=:USUARIO_JUST_IN_TIME
, SENHA_JUST_IN_TIME=:SENHA_JUST_IN_TIME
, DIA_BASE_ACERTO=:DIA_BASE_ACERTO
, CONTROLA_LICENCIADOS=:CONTROLA_LICENCIADOS
, FREQUENCIA_VISITAS=:FREQUENCIA_VISITAS
, ENVIA_CLIENTE=:ENVIA_CLIENTE
, MODALIDADE_FRETE=:MODALIDADE_FRETE
, EVENTO_FAT_AUTO=:EVENTO_FAT_AUTO

WHERE (FORNECEDOR=:FORNECEDOR);

#SELECT(GERADOR_ORIGEM,NULL:{
#CALL millenium.geradores.alteraint(:GERADORES);
},ELSE:{});


//Retornando campos chave do resultado do processo
SELECT FORNECEDOR, GERADOR, TRANS_ID FROM FORNECEDORES WHERE FORNECEDOR = :FORNECEDOR;

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>