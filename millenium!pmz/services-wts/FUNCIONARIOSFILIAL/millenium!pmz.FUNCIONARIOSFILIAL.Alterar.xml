<?xml version="1.0"?>
<root>
  <OBJECT NAME="FUNCIONARIOSFILIAL">
    <METHOD NAME="Alterar" DESCRIPTION="Alterar Cadastro de Funcionarios" VERSION="23" INTFTYPE="2" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="COD_FUNCIONARIO" SIZE="7" FLAGS="17" PROJECTION="0" FIELDLABEL="Cod Funcionario" CTAB="0"/>
        <PARAM NAME="GERADORES" FORMAT="R" FLAGS="17" PROJECTION="0" FIELDLABEL="Geradores" NESTEDNAME="millenium.GERADORES.GERADORES" CTAB="0"/>
        <PARAM NAME="COD_CARGO" SIZE="3" FLAGS="17" PROJECTION="0" FIELDLABEL="Cod Cargo" CTAB="0"/>
        <PARAM NAME="DESATIVADO" FORMAT="B" SIZE="1" FLAGS="17" PROJECTION="0" FIELDLABEL="Desativado" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="FUNCIONARIO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Funcionario" CTAB="0"/>
        <FIELD NAME="GERADOR" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Gerador" CTAB="0"/>
        <FIELD NAME="TRANS_ID" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Trans Id" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>#CHECK("SELECT COUNT(COD_FUNCIONARIO) AS N FROM FUNCIONARIOS WHERE (COD_FUNCIONARIO=:COD_FUNCIONARIO [OR CGC=:GERADORES.CGC] [OR CNPJ=:GERADORES.CNPJ] [OR RG=:GERADORES.RG] [OR CPF=:GERADORES.CPF])", N>0, const.COD_DUPL);

//Executando uma query para retornar o id do funcionario e o id do gerador
#PRIVATE()
SELECT:FUN FUNCIONARIO, GERADOR FROM FUNCIONARIOS WHERE COD_FUNCIONARIO = :COD_FUNCIONARIO;

//Executando uma query para localizar o id da filial
#PRIVATE()
SELECT:CG CARGO FROM CARGOS WHERE COD_CARGO = :COD_CARGO;

UPDATE IFUNCIONARIOS
SET CARGO=:CARGO,
    NAO_MOSTRAR_NO_EVENTO = :DESATIVADO,
    DATA_ULT = #DATE(),
    INATIVO=:DESATIVADO,
    AFASTADO=:DESATIVADO
WHERE (FUNCIONARIO = :FUN.FUNCIONARIO);

#PRIVATE()
#call:GER millenium.geradores.incluiint(:GERADORES);

//Retornando campos chave do resultado do processo
SELECT FUNCIONARIO, GERADOR, TRANS_ID FROM FUNCIONARIOS WHERE FUNCIONARIO = :FUN.FUNCIONARIO;








</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>