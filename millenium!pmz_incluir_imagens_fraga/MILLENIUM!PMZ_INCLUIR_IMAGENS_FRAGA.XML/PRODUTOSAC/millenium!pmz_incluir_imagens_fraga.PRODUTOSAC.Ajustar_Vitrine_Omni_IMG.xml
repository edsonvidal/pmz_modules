<?xml version="1.0"?>
<root>
  <OBJECT NAME="PRODUTOSAC">
    <METHOD NAME="Ajustar_Vitrine_Omni_IMG" DESCRIPTION="Ajustar Vitrine Omni IMG" VERSION="8" THREADSAFE="1">
      <PARAMS/>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="DATA_SOLICITACAO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Data Solicitacao" CTAB="0"/>
        <FIELD NAME="ITENS_PERDIDOS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Itens Perdidos" CTAB="0"/>
        <FIELD NAME="ITENS_SOLICITADOS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Itens Solicitados" CTAB="0"/>
        <FIELD NAME="VENDA_PERDIDA" SIZE="255" PROJECTION="0" FIELDLABEL="Venda Perdida" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>#EACH()
SELECT:IMG
  V.VITRINE_PRODUTO_SKU  AS VITRINE_PRODUTO_SKU,
  CONCAT(
  MIN(V.IMG0)
 ,MIN(V.IMG1)
 ,MIN(V.IMG2)
 ,MIN(V.IMG3)
 ,MIN(V.IMG4)
 ,MIN(V.IMG5)
 )                       AS URL_IMAGENS
 FROM (SELECT
      SKU.VITRINE_PRODUTO_SKU
     ,'catalog0:/api/wtssystem/http/get/data/$value?$width=400&amp;url='+PP.URL AS IMG0
     ,NULL AS IMG1
     ,NULL AS IMG2
     ,NULL AS IMG3
     ,NULL AS IMG4
     ,NULL AS IMG5
    FROM VITRINE_PRODUTOS_SKU SKU
      INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
      INNER JOIN PMZ_CATALOGO_IMAGENS PP ON PP.COD_PRODUTO = P.COD_PRODUTO
    WHERE SKU.VITRINE = 301
      AND PP.URL LIKE '%-0.jpg%'
    UNION ALL
    SELECT
      SKU.VITRINE_PRODUTO_SKU
     ,NULL AS IMG0
     ,',catalog1:/api/wtssystem/http/get/data/$value?$width=400&amp;url='+PP.URL AS IMG1
     ,NULL AS IMG2
     ,NULL AS IMG3
     ,NULL AS IMG4
     ,NULL AS IMG5
    FROM VITRINE_PRODUTOS_SKU SKU
      INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
      INNER JOIN PMZ_CATALOGO_IMAGENS PP ON PP.COD_PRODUTO = P.COD_PRODUTO
    WHERE SKU.VITRINE = 301
      AND PP.URL LIKE '%-1.jpg%'
    UNION ALL
    SELECT
      SKU.VITRINE_PRODUTO_SKU
     ,NULL AS IMG0
     ,NULL AS IMG1
     ,',catalog2:/api/wtssystem/http/get/data/$value?$width=400&amp;url='+PP.URL AS IMG2
     ,NULL AS IMG3
     ,NULL AS IMG4
     ,NULL AS IMG5
    FROM VITRINE_PRODUTOS_SKU SKU
      INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
      INNER JOIN PMZ_CATALOGO_IMAGENS PP ON PP.COD_PRODUTO = P.COD_PRODUTO
    WHERE SKU.VITRINE = 301
      AND PP.URL LIKE '%-2.jpg%'
    UNION ALL
    SELECT
      SKU.VITRINE_PRODUTO_SKU
     ,NULL AS IMG0
     ,NULL AS IMG1
     ,NULL AS IMG2
     ,',catalog3:/api/wtssystem/http/get/data/$value?$width=400&amp;url='+PP.URL AS IMG3
     ,NULL AS IMG4
     ,NULL AS IMG5
    FROM VITRINE_PRODUTOS_SKU SKU
      INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
      INNER JOIN PMZ_CATALOGO_IMAGENS PP ON PP.COD_PRODUTO = P.COD_PRODUTO
    WHERE SKU.VITRINE = 301
      AND PP.URL LIKE '%-3.jpg%'
	UNION ALL
    SELECT
      SKU.VITRINE_PRODUTO_SKU
     ,NULL AS IMG0
     ,NULL AS IMG1
     ,NULL AS IMG2
     ,NULL AS IMG3
     ,',catalog4:/api/wtssystem/http/get/data/$value?$width=400&amp;url='+PP.URL AS IMG4
     ,NULL AS IMG5
    FROM VITRINE_PRODUTOS_SKU SKU
      INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
      INNER JOIN PMZ_CATALOGO_IMAGENS PP ON PP.COD_PRODUTO = P.COD_PRODUTO
    WHERE SKU.VITRINE = 301
      AND PP.URL LIKE '%-4.jpg%'
		UNION ALL
    SELECT
      SKU.VITRINE_PRODUTO_SKU
     ,NULL AS IMG0
     ,NULL AS IMG1
     ,NULL AS IMG2
     ,NULL AS IMG3
	 ,NULL AS IMG4
     ,',catalog5:/api/wtssystem/http/get/data/$value?$width=400&amp;url='+PP.URL AS IMG5
    FROM VITRINE_PRODUTOS_SKU SKU
      INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
      INNER JOIN PMZ_CATALOGO_IMAGENS PP ON PP.COD_PRODUTO = P.COD_PRODUTO
    WHERE SKU.VITRINE = 301
      AND PP.URL LIKE '%-5.jpg%')V
INNER JOIN vitrine_produtos_sku vps ON VPS.VITRINE_PRODUTO_SKU = V.VITRINE_PRODUTO_SKU
WHERE VPS.URL_IMAGENS IS NULL
GROUP BY V.VITRINE_PRODUTO_SKU

  #BEGIN
  
    UPDATE VITRINE_PRODUTOS_SKU
      SET
        URL_IMAGENS = :IMG.URL_IMAGENS
    WHERE VITRINE = 301
    AND VITRINE_PRODUTO_SKU = :IMG.VITRINE_PRODUTO_SKU;

  #END;
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>