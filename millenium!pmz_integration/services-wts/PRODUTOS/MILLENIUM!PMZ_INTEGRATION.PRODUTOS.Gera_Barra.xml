<?xml version="1.0"?>
<root>
  <OBJECT NAME="PRODUTOS">
    <METHOD NAME="Gera_Barra" DESCRIPTION="" VERSION="5" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="PRODUTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Pproduto" CTAB="0"/>
        <PARAM NAME="TIPO_BARRA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Tipo Barra" CTAB="0"/>
        <PARAM NAME="QUANTIDADE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Quantidade" CTAB="0"/>
        <PARAM NAME="BARRA" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="Barra" CTAB="0"/>
      </PARAMS>
      <FIELDS/>
      <ACTIONSCRIPT>#EACH()
  SELECT:B2
    SKU.PRODUTO
   ,SKU.COR
   ,SKU.ESTAMPA
   ,SKU.TAMANHO
   ,#REPLACET(BARRA)      AS BARRA
   ,#REPLACE(TIPO_BARRA)  AS TIPO_BARRA
   ,#REPLACE(QUANTIDADE)  AS QUANTIDADE
  FROM PRODUTO_SKU SKU
    INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
  WHERE P.PRODUTO = :PRODUTO
    AND NOT EXISTS
    (SELECT * FROM CODIGO_BARRAS CB
     WHERE CB.TIPO_BARRA = :TIPO_BARRA
       AND CB.PRODUTO = SKU.PRODUTO
       AND CB.COR = SKU.COR
       AND CB.ESTAMPA = SKU.ESTAMPA
       AND CB.TAMANHO = SKU.TAMANHO
       AND CB.BARRA = :BARRA
       AND CB.QUANTIDADE = :QUANTIDADE
    )

  GROUP BY
    SKU.PRODUTO
   ,SKU.COR
   ,SKU.ESTAMPA
   ,SKU.TAMANHO
   ,P.COD_PRODUTO

 #BEGIN

//#call millenium.codigo_barras.incluir();
   INSERT INTO CODIGO_BARRAS(
     PRODUTO,
     COR,
     ESTAMPA,
     TAMANHO,
     BARRA,
     QUANTIDADE,
     TIPO_BARRA
     )
    VALUES (
      :B2.PRODUTO,
      :B2.COR,
      :B2.ESTAMPA,
      :B2.TAMANHO,
      :B2.BARRA,
      :B2.QUANTIDADE,
      :B2.TIPO_BARRA)
    #RETURN ( CODIGO_BARRA );
 #END
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>