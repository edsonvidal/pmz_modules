<?xml version="1.0"?>
<root>
  <OBJECT NAME="FORNECEDORES">
    <METHOD NAME="BKP" DESCRIPTION="" VERSION="2" THREADSAFE="1">
      <PARAMS/>
      <FIELDS/>
      <ACTIONSCRIPT>#CHECK("SELECT COUNT(COD_FORNECEDOR) AS N FROM FORNECEDORES WHERE (COD_FORNECEDOR=:COD_FORNECEDOR [OR CGC=:GERADORES.CGC] [OR CNPJ=:GERADORES.CNPJ] [OR RG=:GERADORES.RG] [OR CPF=:GERADORES.CPF])", N>0, const.FORNECEDOR_DUPLICADO);

#SELECT(GERADOR_ORIGEM,NULL:{
#call:GER millenium.geradores.incluiint(:GERADORES);
},ELSE:{});

INSERT:FORN INTO IFORNECEDORES( COD_FORNECEDOR, GERADOR, PCONTA, PRODUTOS_FORNEC, EAN, OFICINA, STATUS , HOMOLOGADO , VALIDADE_HOMOLOGACAO , ULT_COMPRA, INTERMEDIARIO, BANCO, FILIAL, ENVIO_TITULO, CLSFORNEC, CC_CREDITO,CC_DEBITO, DESCONTO, GRUPO_LOJA, GERA_TITULO_PREVISAO, DISPONIVEL_WEB, DATA_CADASTRO, DATA_ATUALIZACAO, PASTACOTACAO
, CC_ADIANTAMENTO
, LICENCIADO
, ROYALTIE
, E_MAIL_NFE
, INTEGRACAO_JUST_IN_TIME
, INTEGRACAO_JUST_IN_TIME_ESTOQUE
, URL_REST
, TIPO_PEDIDO
, CONDICOES_PGTO
, CENTRO_CUSTOS
, USUARIO_JUST_IN_TIME
, SENHA_JUST_IN_TIME
, DIA_BASE_ACERTO
, CONTROLA_LICENCIADOS
, FREQUENCIA_VISITAS
, ENVIA_CLIENTE
, MODALIDADE_FRETE
, EVENTO_FAT_AUTO
 )
VALUES ( :COD_FORNECEDOR, #SELECT(GERADOR_ORIGEM,NULL:{:GER.GERADOR},ELSE:{:GERADOR_ORIGEM})
, :PCONTA, :PRODUTOS_FORNEC, :EAN, :OFICINA, :STATUS , :HOMOLOGADO , :VALIDADE_HOMOLOGACAO , :ULT_COMPRA, :INTERMEDIARIO, :BANCO, :FILIAL, :ENVIO_TITULO, :CLSFORNEC, :CC_CREDITO, :CC_DEBITO, :DESCONTO, :GRUPO_LOJA, :GERA_TITULO_PREVISAO, :DISPONIVEL_WEB, #NOW(), #NOW(), :PASTACOTACAO
, :CC_ADIANTAMENTO
, :LICENCIADO
, :ROYALTIE
, :E_MAIL_NFE
, :INTEGRACAO_JUST_IN_TIME
, :INTEGRACAO_JUST_IN_TIME_ESTOQUE
, :URL_REST
, :TIPO_PEDIDO
, :CONDICOES_PGTO
, :CENTRO_CUSTOS
, :USUARIO_JUST_IN_TIME
, :SENHA_JUST_IN_TIME
, :DIA_BASE_ACERTO
, :CONTROLA_LICENCIADOS
, :FREQUENCIA_VISITAS
, :ENVIA_CLIENTE
, :MODALIDADE_FRETE
, :EVENTO_FAT_AUTO
)
#RETURN ( FORNECEDOR);

//Retornando campos chave do resultado do processo
SELECT FORNECEDOR, GERADOR, TRANS_ID FROM FORNECEDORES WHERE FORNECEDOR = :FORN.FORNECEDOR;
///////////Alteracao


//Executando uma query para retornar o id do cliente e o id do gerador
#PRIVATE()
SELECT :FORN FORNECEDOR, GERADOR, OFICINA , ENVIO_TITULO , COD_FORNECEDOR FROM FORNECEDORES WHERE COD_FORNECEDOR = :COD_FORNECEDOR;

#PRIVATE()
#CHECK("SELECT COUNT(COD_FORNECEDOR) AS N FROM FORNECEDORES WHERE (COD_FORNECEDOR=:FORN.COD_FORNECEDOR [OR CGC=:GERADORES.CGC] [OR CNPJ=:GERADORES.CNPJ] [OR RG=:GERADORES.RG] [OR CPF=:GERADORES.CPF]) AND FORNECEDOR&lt;>:FORN.FORNECEDOR", N>0, const.FORNECEDOR_DUPLICADO);

SELECT COUNT(F.COD_FORNECEDOR) AS C
  FROM FORNECEDORES F
 INNER JOIN LANCAMENTOS L
       ON L.COD = F.FORNECEDOR AND L.GERADOR = 'O'
 INNER JOIN PRODUCAO P
       ON P.PRODUCAO = L.ORIGEM AND L.TIPO_ORIGEM = 'P'
 WHERE F.FORNECEDOR = :FORN.FORNECEDOR
   AND F.OFICINA=:OFICINA
   AND F.ENVIO_TITULO &lt;> :ENVIO_TITULO
   AND P.STATUS &lt;> 'F'
   AND P.STATUS &lt;> 'Q'
#CHECK("",C > 0,"Existem titulos de ordens de produ&#231;&#227;o em aberto gerados para este fornecedor.");

#PRIVATE()
UPDATE IFORNECEDORES
SET  PCONTA=:PCONTA,
     PRODUTOS_FORNEC=:PRODUTOS_FORNEC,
     EAN=:EAN,
     OFICINA=:OFICINA,
     STATUS=:STATUS ,
     HOMOLOGADO =:HOMOLOGADO ,
     VALIDADE_HOMOLOGACAO =:VALIDADE_HOMOLOGACAO ,
     ULT_COMPRA =:ULT_COMPRA ,
     INTERMEDIARIO=:INTERMEDIARIO ,
     BANCO = :BANCO,
     FILIAL = :FILIAL,
     ENVIO_TITULO=:ENVIO_TITULO,
     CLSFORNEC = :CLSFORNEC,
     CC_CREDITO=:CC_CREDITO,
     CC_DEBITO=:CC_DEBITO,
     DESCONTO=:DESCONTO,
     GRUPO_LOJA=:GRUPO_LOJA,
     GERA_TITULO_PREVISAO=:GERA_TITULO_PREVISAO,
     DISPONIVEL_WEB=:DISPONIVEL_WEB,
     DATA_ATUALIZACAO=#NOW(),
     PASTACOTACAO=:PASTACOTACAO
     , CC_ADIANTAMENTO=:CC_ADIANTAMENTO
     , LICENCIADO=:LICENCIADO
     , ROYALTIE=:ROYALTIE
     , E_MAIL_NFE=:E_MAIL_NFE
     , INTEGRACAO_JUST_IN_TIME=:INTEGRACAO_JUST_IN_TIME
     , INTEGRACAO_JUST_IN_TIME_ESTOQUE=:INTEGRACAO_JUST_IN_TIME_ESTOQUE
     , URL_REST=:URL_REST
     , TIPO_PEDIDO=:TIPO_PEDIDO
     , CONDICOES_PGTO=:CONDICOES_PGTO
     , CENTRO_CUSTOS=:CENTRO_CUSTOS
     , USUARIO_JUST_IN_TIME=:USUARIO_JUST_IN_TIME
     , SENHA_JUST_IN_TIME=:SENHA_JUST_IN_TIME
     , DIA_BASE_ACERTO=:DIA_BASE_ACERTO
     , CONTROLA_LICENCIADOS=:CONTROLA_LICENCIADOS
     , FREQUENCIA_VISITAS=:FREQUENCIA_VISITAS
     , ENVIA_CLIENTE=:ENVIA_CLIENTE
     , MODALIDADE_FRETE=:MODALIDADE_FRETE
     , EVENTO_FAT_AUTO=:EVENTO_FAT_AUTO
WHERE (FORNECEDOR= :FORN.FORNECEDOR);

#PRIVATE()
#SELECT(GERADOR_ORIGEM,NULL:{
#CALL millenium.geradores.alteraint(:GERADORES);
},ELSE:{});

//Retornando campos chave do resultado do processo
#PRIVATE()
SELECT FORNECEDOR, GERADOR, TRANS_ID FROM FORNECEDORES WHERE FORNECEDOR = :FORN.FORNECEDOR;

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>