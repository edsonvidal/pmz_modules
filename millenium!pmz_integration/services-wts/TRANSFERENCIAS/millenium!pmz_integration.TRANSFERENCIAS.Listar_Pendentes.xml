<?xml version="1.0"?>
<root>
  <OBJECT NAME="TRANSFERENCIAS">
    <METHOD NAME="Listar_Pendentes" DESCRIPTION="Listar Prefaturamento Em Aberto" VERSION="15" INTFTYPE="5" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="COD_PREFATURAMENTO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Cod Prefaturamento" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="PREFATURAMENTO_T" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Prefaturamento" CTAB="0"/>
        <FIELD NAME="COD_PREFATURAMENTO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="C&#243;digo Prefaturamento" CTAB="0"/>
        <FIELD NAME="COD_FILIAL_ORIGEM" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Filial Origem" CTAB="0"/>
        <FIELD NAME="COD_FILIAL_DESTINO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Filial Destino" CTAB="0"/>
        <FIELD NAME="DATA" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Data" CTAB="0"/>
        <FIELD NAME="PRODUTOS" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Produtos" NESTEDNAME="millenium!pmz_integration.TRANSFERENCIAS.ITEM" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT:MAIN
  PF.PREFATURAMENTO_T AS PREFATURAMENTO_T
 ,PF.NUMERO           AS COD_PREFATURAMENTO
 ,FO.COD_FILIAL       AS COD_FILIAL_ORIGEM
 ,FD.COD_FILIAL       AS COD_FILIAL_DESTINO
 ,PF.DATA             AS DATA
  #ROWSET({
   SELECT:PRODUTOS
    PE.PRODUTO
   ,PE.COR
   ,PE.ESTAMPA
   ,PE.TAMANHO
   ,PE.ITEM
   ,MIN(P.COD_PRODUTO)            AS COD_PRODUTO
   ,SUM(PE.QUANTIDADE)            AS QUANTIDADE
   ,(SELECT
       FIRST 1 CB.BARRA
     FROM CODIGO_BARRAS CB
     WHERE CB.TIPO_BARRA = 3
     AND CB.PRODUTO = PE.PRODUTO
     AND CB.COR = PE.COR
     AND CB.ESTAMPA = PE.ESTAMPA
     AND CB.TAMANHO = PE.TAMANHO
     AND CB.QUANTIDADE = 1
     AND CB.FORNECEDOR IS NULL) AS ID
  FROM PRODUTO_PREFAT_T PE
    INNER JOIN PRODUTOS P ON P.PRODUTO = PE.PRODUTO
  WHERE PE.PREFATURAMENTO_T = :MAIN.PREFATURAMENTO_T
  GROUP BY
    PE.PRODUTO
   ,PE.COR
   ,PE.ESTAMPA
   ,PE.TAMANHO
   ,PE.ITEM
  ORDER BY
    PE.PRODUTO
   ,PE.COR
   ,PE.ESTAMPA
   ,PE.TAMANHO
   ,PE.ITEM
  })
FROM PREFATURAMENTO_T PF
  INNER JOIN FILIAIS FO ON FO.FILIAL = PF.FILIAL_ORIGEM
  INNER JOIN FILIAIS FD ON FD.FILIAL = PF.FILIAL_DESTINO
WHERE (PF.ENTREGUE = 'F' OR (PF.EXCLUIDO = 'F'))
  [AND PF.NUMERO = :COD_PREFATURAMENTO]
;

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>