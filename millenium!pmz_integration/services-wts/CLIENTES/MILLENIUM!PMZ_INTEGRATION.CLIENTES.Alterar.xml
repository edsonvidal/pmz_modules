<?xml version="1.0"?>
<root>
  <OBJECT NAME="CLIENTES">
    <METHOD NAME="Alterar" DESCRIPTION="Atualizar Dados do Cliente" VERSION="130" INTFTYPE="2" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="COD_CLIENTE" SIZE="12" FLAGS="17" SOURCEEXPRESSION="cliente.Gerador.COD_CLIENTE" PROJECTION="0" ORDER="17" FIELDLABEL="Cod Cliente" CTAB="0"/>
        <PARAM NAME="DATA_CADASTRO" FORMAT="D" SIZE="14" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.DATA_CADASTRO" PROJECTION="0" ORDER="11" FIELDLABEL="Data Cadastro" CTAB="0"/>
        <PARAM NAME="DATA_ATUALIZACAO" FORMAT="D" SIZE="14" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.DATA_ATUALIZACAO" PROJECTION="0" ORDER="9" FIELDLABEL="Data Atualizacao" CTAB="0"/>
        <PARAM NAME="LIMITE_CREDITO" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" DEFAULT="0" SOURCEEXPRESSION="cliente.Gerador.LIMITE_CREDITO" PROJECTION="0" ORDER="28" FIELDLABEL="Limite Credito" CTAB="0"/>
        <PARAM NAME="CONCEITO" FORMAT="N" SIZE="8" FLAGS="1" DEFAULT="0" SOURCEEXPRESSION="cliente.Gerador.CONCEITO" PROJECTION="0" ORDER="18" FIELDLABEL="Conceito" CTAB="0"/>
        <PARAM NAME="BLOQUEIA_VENDAS" FORMAT="B" SIZE="1" FLAGS="17" DEFAULT="0" SOURCEEXPRESSION="cliente.Gerador.BLOQUEIA_VENDAS" PROJECTION="0" ORDER="15" FIELDLABEL="Bloqueia Vendas" CTAB="0"/>
        <PARAM NAME="BLOQUEIA_PEDIDOS" FORMAT="B" SIZE="1" FLAGS="17" DEFAULT="0" SOURCEEXPRESSION="cliente.Gerador.BLOQUEIA_PEDIDOS" PROJECTION="0" ORDER="14" FIELDLABEL="Bloqueia Pedidos" CTAB="0"/>
        <PARAM NAME="HISTORICO_BLOQUEIO" SIZE="200" FLAGS="1" PROJECTION="0" ORDER="27" FIELDLABEL="Historico Bloqueio" CTAB="0"/>
        <PARAM NAME="COD_FILIAL" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="24" FIELDLABEL="Filial" CTAB="0"/>
        <PARAM NAME="BANCO" FORMAT="N" SIZE="5" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="Banco" CTAB="0"/>
        <PARAM NAME="GRUPO_LOJA" FORMAT="N" SIZE="8" FLAGS="1" SOURCEEXPRESSION="cliente.grupo_loja" PROJECTION="0" ORDER="26" FIELDLABEL="Grupo Loja" CTAB="0"/>
        <PARAM NAME="CADASTRO_CREDITO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="16" FIELDLABEL="Cadastro Credito" CTAB="0"/>
        <PARAM NAME="DADOS_ADICIONAIS" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="19" FIELDLABEL="Dados Adicionais" CTAB="0"/>
        <PARAM NAME="GERADOR_C" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Gerador C" CTAB="0"/>
        <PARAM NAME="PROFISSAO" FORMAT="N" SIZE="8" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.profissao" PROJECTION="0" ORDER="34" FIELDLABEL="Profissao" CTAB="0"/>
        <PARAM NAME="NATURALIDADE" SIZE="50" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.NATURALIDADE" PROJECTION="0" ORDER="29" FIELDLABEL="Naturalidade" CTAB="0"/>
        <PARAM NAME="ESTADO_CIVIL" SIZE="50" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.ESTADO_CIVIL" PROJECTION="0" ORDER="22" FIELDLABEL="Estado Civil" CTAB="0"/>
        <PARAM NAME="FILIACAO" SIZE="50" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.FILIACAO" PROJECTION="0" ORDER="23" FIELDLABEL="Filiacao" CTAB="0"/>
        <PARAM NAME="DATA_BLOQUEIO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Data Bloqueio" CTAB="0"/>
        <PARAM NAME="OBS_FAT" FLAGS="1" PROJECTION="0" ORDER="33" FIELDLABEL="Obs Fat" CTAB="0"/>
        <PARAM NAME="OBS_CLI_FAT" FLAGS="1" PROJECTION="0" ORDER="30" FIELDLABEL="Obs Cli Fat" CTAB="0"/>
        <PARAM NAME="OBS_CLI_PREFAT" FLAGS="1" PROJECTION="0" ORDER="32" FIELDLABEL="Obs Cli Prefat" CTAB="0"/>
        <PARAM NAME="OBS_CLI_PEDIDO" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.OBS_CLI_PEDIDO" PROJECTION="0" ORDER="31" FIELDLABEL="Obs Cli Pedido" CTAB="0"/>
        <PARAM NAME="EMPRESA" SIZE="100" FLAGS="1" SOURCEEXPRESSION="cliente.Gerador.EMPRESA" PROJECTION="0" ORDER="21" FIELDLABEL="Empresa" CTAB="0"/>
        <PARAM NAME="E_MAIL_NFE" SIZE="250" FLAGS="1" PROJECTION="0" HINT="Para enviar o email para mais de um destinat&#225;rio digite os emails separados por ponto e v&#237;rgula (;).&lt;p> &#xA;&lt;B>Ex:&lt;/font>&lt;/B> &#xA;email1@seudominio.com.br;email2@seudominio.com.br" ORDER="20" FIELDLABEL="E Mail Nfe" CTAB="0"/>
        <PARAM NAME="CC_ADIANTAMENTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Cc Adiantamento" CTAB="0"/>
        <PARAM NAME="CC_CREDITO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Cc Credito" CTAB="0"/>
        <PARAM NAME="CC_DEBITO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Cc Debito" CTAB="0"/>
        <PARAM NAME="TIPO_CLI" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="Tipo Cli" CTAB="0"/>
        <PARAM NAME="DESCONTO" FORMAT="N" SIZE="8" FLAGS="1" DECIMALS="2" PROJECTION="0" ORDER="3" FIELDLABEL="Desconto" CTAB="0"/>
        <PARAM NAME="GERADOR_ORIGEM" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Gerador Origem" CTAB="0"/>
        <PARAM NAME="GERADORES" FORMAT="R" FLAGS="1" VISIBILITYRULE="(GERADOR_ORIGEM='')" PROJECTION="0" ORDER="25" FIELDLABEL="Geradores" NESTEDNAME="millenium.GERADORES.GERADORES" CTAB="0"/>
        <PARAM NAME="CONDICAO_PAGAMENTO" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Condicao Pagamento" NESTEDNAME="MILLENIUM!PMZ_INTEGRATION.CLIENTES.CONDICAO_PAGAMENTO" CTAB="0"/>
        <PARAM NAME="COMPLEMENTO" FORMAT="R" FLAGS="9" PROJECTION="0" ORDER="1" FIELDLABEL="Complemento" NESTEDNAME="MILLENIUM!PMZ_INTEGRATION.CLIENTES.COMPLEMENTO" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="CLIENTE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="36" FIELDLABEL="Cliente" CTAB="0"/>
        <FIELD NAME="GERADOR" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="37" FIELDLABEL="Gerador" CTAB="0"/>
        <FIELD NAME="TRANS_ID" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="38" FIELDLABEL="Trans Id" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>//Executando uma query para retornar o id do cliente e o id do gerador
#PRIVATE()
SELECT:CL CLIENTE, GERADOR FROM CLIENTES WHERE (CGC = :GERADORES.CGC OR (CPF = :GERADORES.CPF));
  #SELECT(CL._EOF, TRUE:{#CHECK("SELECT COUNT(*) AS N FROM DUAL",N>0,"Cliente n&#227;o encontrado !")},ELSE:{});


//Chamando um servi&#231;o para localizar o id do banco
#PRIVATE()
#CALL:BCO MILLENIUM.BANCOS.LISTATODOS(ORDEM=1,COD_BANCO=:BANCO);

//Cria tabela temporaria para armazenamento e tratamento dos dados das condicoes de pagamento
#SET(TBCONDPAGTO, ${#CREATETABLE( COD_CONDICAO_PAGAMENTO   VARCHAR(3) ) } );

#EACH() CONDICAO_PAGAMENTO AS CP
    INSERT INTO #REPLACE(TBCONDPAGTO) ( COD_CONDICAO_PAGAMENTO ) VALUES ( :CP.COD_CONDICAO_PAGAMENTO);

//Prepara os registros das condicoes de pagamento
SELECT:COND_PAGTO
       cond.condicoes_pgto AS ITEM
  FROM #REPLACE(TBCONDPAGTO) L
 INNER JOIN condicoes_pgto cond ON cond.codigo=L.COD_CONDICAO_PAGAMENTO;


//Busca ID das contas contabeis

SELECT:CTB ( SELECT  PCONTA  FROM PLANO_CONTAS WHERE CODIGO =:CC_DEBITO)       AS CC_DEBITO,
           ( SELECT  PCONTA  FROM PLANO_CONTAS WHERE CODIGO =:CC_CREDITO)      AS CC_CREDITO,
           ( SELECT  PCONTA  FROM PLANO_CONTAS WHERE CODIGO =:CC_ADIANTAMENTO) AS CC_ADIANTAMENTO
  FROM dual;
  

#PRIVATE()
#CALL  millenium.clientes.alterar(
CLIENTE            = :CL.CLIENTE,
COD_CLIENTE        = :COD_CLIENTE,
DATA_CADASTRO      = :DATA_CADASTRO,
DATA_ATUALIZACAO   = :DATA_ATUALIZACAO,
LIMITE_CREDITO     = :LIMITE_CREDITO,
CONCEITO           = :CONCEITO          ,
BLOQUEIA_VENDAS    = :BLOQUEIA_VENDAS    ,
BLOQUEIA_PEDIDOS   = :BLOQUEIA_PEDIDOS    ,
HISTORICO_BLOQUEIO = :HISTORICO_BLOQUEIO ,
BANCO              = :BCO.BANCO,
GRUPO_LOJA         = :GRUPO_LOJA    ,
CADASTRO_CREDITO   = :CADASTRO_CREDITO ,
DADOS_ADICIONAIS   = :DADOS_ADICIONAIS   ,
GERADOR_C          = :GERADOR_C       ,
PROFISSAO          = :PROFISSAO      ,
NATURALIDADE       = :NATURALIDADE    ,
ESTADO_CIVIL       = :ESTADO_CIVIL    ,
FILIACAO           = :FILIACAO        ,
DATA_BLOQUEIO      = :DATA_BLOQUEIO   ,
OBS_FAT            = :OBS_FAT        ,
OBS_CLI_FAT        = :OBS_CLI_FAT    ,
OBS_CLI_PREFAT     = :OBS_CLI_PREFAT  ,
OBS_CLI_PEDIDO     = :OBS_CLI_PEDIDO  ,
EMPRESA            = :EMPRESA      ,
E_MAIL_NFE         = :E_MAIL_NFE  ,
CC_ADIANTAMENTO    = :CTB.CC_ADIANTAMENTO,
CC_CREDITO         = :CTB.CC_DEBITO,
CC_DEBITO          = :CTB.CC_CREDITO,
CONTROLA_GRADE     =  FALSE     ,
RESIDENCIA_PROPRIA =  TRUE     ,
INTEGRACAO_JUST_IN_TIME   = FALSE ,
COD_BARRA_CLIENTE         = FALSE  ,
ORIGEM_CLIENTE            = 'LEGADO PMZ' ,
PERMITE_ENVIAR_SMS        = FALSE   ,
PERMITE_ENVIAR_NEWSLETTER = FALSE  ,
TRATAMENTO     = 0 ,
DESCONTO       = :DESCONTO,
GERADOR_ORIGEM = :GERADOR_ORIGEM,
GERADORES      = :GERADORES,
COND_PAGTO     = :COND_PAGTO,
TIPO_CLI       = :TIPO_CLI );


#PRIVATE()
DELETE FROM pmz_clientes_compl WHERE CLIENTE=:ICLI.CLIENTE;


#EACH() COMPLEMENTO;
insert into pmz_clientes_compl (CLIENTE,AGRUPAR_NOTAS,COBRADOR,TIPO_PRECO,CARTA_FIANCA,VALOR_CARTA,PRAZO_MEDIO,CONCEITO,EXIGNFDV,TPEMPRESA,QTD_ELEVADOR,QTD_MECANICO,QTD_VEICULOS,QTD_VENDEDOR,
                                LINHA_LEVE,LINHA_PESADA,LINHA_MEDIA,LINHA_OUTRAS,METRAGEM_AUTO,METRAGEM_OFIC,PERCENTUAL_AUMENTO)
values(:ICLI.CLIENTE,:COMPLEMENTO.AGRUPAR_NOTAS,:COMPLEMENTO.COBRADOR,:COMPLEMENTO.TIPO_PRECO,:COMPLEMENTO.CARTA_FIANCA,:COMPLEMENTO.VALOR_CARTA,:COMPLEMENTO.PRAZO_MEDIO,:COMPLEMENTO.CONCEITO,
       :COMPLEMENTO.EXIGNFDV,:COMPLEMENTO.TPEMPRESA,:COMPLEMENTO.QTD_ELEVADOR,:COMPLEMENTO.QTD_MECANICO,:COMPLEMENTO.QTD_VEICULOS,:COMPLEMENTO.QTD_VENDEDOR,:COMPLEMENTO.LINHA_LEVE,:COMPLEMENTO.LINHA_PESADA,
       :COMPLEMENTO.LINHA_MEDIA,:COMPLEMENTO.LINHA_OUTRAS,:COMPLEMENTO.METRAGEM_AUTO,:COMPLEMENTO.METRAGEM_OFIC,:COMPLEMENTO.PERCENTUAL_AUMENTO)
#RETURN(COMPLEMENTO_CLIENTE);


//Retornando campos chave do resultado do processo
SELECT CLIENTE, GERADOR, TRANS_ID FROM CLIENTES WHERE CLIENTE = :CL.CLIENTE;
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>