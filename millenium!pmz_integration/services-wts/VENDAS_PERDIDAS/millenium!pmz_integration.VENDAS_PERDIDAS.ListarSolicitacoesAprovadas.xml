<?xml version="1.0"?>
<root>
  <OBJECT NAME="VENDAS_PERDIDAS">
    <METHOD NAME="ListarSolicitacoesAprovadas" DESCRIPTION="Solicita&#231;&#245;es Aprovadas" VERSION="23" CATEGORY="VENDAS" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="DATA_APROVACAO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Data Aprova&#231;&#227;o" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="DATA_APROVACAO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Data Aprova&#231;&#227;o" CTAB="0"/>
        <FIELD NAME="ITENS_SOLICITADOS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="Itens Solicitados(Gerente)" CTAB="0"/>
        <FIELD NAME="ITENS_APROVADOS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Itens Aprovados(Comprador)" CTAB="0"/>
        <FIELD NAME="VENDA_PERDIDA" SIZE="255" PROJECTION="0" FIELDLABEL="Venda Perdida" CTAB="0"/>
        <FIELD NAME="STATUS" SIZE="1" FLAGS="1" PROJECTION="0" FIELDLABEL="Status" CTAB="0"/>
        <FIELD NAME="COD_FILIAL" SIZE="10" FLAGS="1" PROJECTION="0" FIELDLABEL="Cod Filial" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT OVP.DATA_APROVACAO,
       MIN(#NULL_TO_Z(OVP.STATUS)) AS STATUS,
       SUM(OVP.QUANTIDADE_SOLICITADA) AS ITENS_SOLICITADOS,
       SUM(OVP.QUANTIDADE_APROVADA) AS ITENS_APROVADOS,
       LIST(OVP.VENDA_PERDIDA) AS VENDA_PERDIDA,
       MIN(COD_FILIAL) AS COD_FILIAL
FROM OMNI_VENDAS_PERDIDAS OVP
INNER JOIN FILIAIS FL ON FL.FILIAL = OVP.FILIAL
WHERE #NULL_TO_Z(OVP.STATUS) = 2
      [AND CAST(OVP.DATA_APROVACAO AS DATE) =:DATA_APROVACAO]
GROUP BY OVP.DATA_APROVACAO
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>